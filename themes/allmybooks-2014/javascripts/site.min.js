"use strict";function updateFinishedList(a){jQuery("#loading-container").toggle(),jQuery.ajax({type:"POST",url:templateDirectory+"/php/save-list.php",data:"list=fin&id="+a,success:function(a){jQuery("#loading-container").toggle(),a.length&&jQuery("#logged-out-warning").addClass("animate-open").removeClass("animate-close").children("p").text(a)}})}function updateCurrentList(a){jQuery("#loading-container").toggle(),jQuery.ajax({type:"POST",url:templateDirectory+"/php/save-list.php",data:"list=cur&id="+a,success:function(a){jQuery("#loading-container").toggle(),a.length&&jQuery("#logged-out-warning").addClass("animate-open").removeClass("animate-close").children("p").text(a)}})}function updateFutureList(){var a=[],b=1;jQuery("#future-read-list li").each(function(){var c=jQuery(this).data("order");c!=b&&a.push(this.id+":"+b),b++});var c=a.join(",");jQuery("#loading-container").toggle(),jQuery.ajax({type:"POST",url:templateDirectory+"/php/save-list.php",data:"list=fut&future_list="+c,success:function(a){jQuery("#loading-container").toggle(),a.length&&jQuery("#logged-out-warning").addClass("animate-open").removeClass("animate-close").children("p").text(a)}})}function checkVisible(a,b){b=b||"visible";var c=$(window).height(),d=$(window).scrollTop(),e=$(a).offset().top,f=$(a).height();return"visible"===b?c+d>e&&e>d-f:"above"===b?c+d>e:void 0}function visibleLooper(){jQuery("#future-read-list.expanded").length&&jQuery("#future-read-list .overflow").each(function(){if(!jQuery(this).hasClass("animate")&&checkVisible(jQuery(this),"above")){var a=Math.floor(1e3*Math.random());jQuery(this).delay(a).queue(function(){jQuery(this).addClass("animate").dequeue()})}})}var $=jQuery;!function(a){var b,c=a();a.fn.sortable=function(d){var e=String(d);return d=a.extend({connectWith:!1,placeholder:null,dragImage:null},d),this.each(function(){if("reload"===e&&a(this).children(d.items).off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),/^enable|disable|destroy$/.test(e)){var f=a(this).children(a(this).data("items")).attr("draggable","enable"===e);return void("destroy"===e&&(a(this).off("sortupdate"),a(this).removeData("opts"),f.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s").off("sortupdate")))}var g=a(this).data("opts");"undefined"==typeof g?a(this).data("opts",d):d=g;var h,i,j,k,l=a(this).children(d.items),m=null===d.placeholder?a("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">'):a(d.placeholder).addClass("sortable-placeholder");l.find(d.handle).mousedown(function(){h=!0}).mouseup(function(){h=!1}),a(this).data("items",d.items),c=c.add(m),d.connectWith&&a(d.connectWith).add(this).data("connectWith",d.connectWith),l.attr("draggable","true").on("dragstart.h5s",function(c){if(c.stopImmediatePropagation(),d.handle&&!h)return!1;h=!1;var e=c.originalEvent.dataTransfer;e.effectAllowed="move",e.setData("text",""),d.dragImage&&e.setDragImage&&e.setDragImage(d.dragImage,0,0),i=(b=a(this)).addClass("sortable-dragging").index(),j=a(this).parent()}).on("dragend.h5s",function(){b&&(b.removeClass("sortable-dragging").show(),c.detach(),k=a(this).parent(),(i!==b.index()||j.get(0)!==k.get(0))&&b.parent().triggerHandler("sortupdate",{item:b,oldindex:i,startparent:j,endparent:k}),b=null)}).not("a[href], img").on("selectstart.h5s",function(){return d.handle&&!h?!0:(this.dragDrop&&this.dragDrop(),!1)}).end().add([this,m]).on("dragover.h5s dragenter.h5s drop.h5s",function(e){if(!l.is(b)&&d.connectWith!==a(b).parent().data("connectWith"))return!0;if("drop"===e.type)return e.stopPropagation(),c.filter(":visible").after(b),b.trigger("dragend.h5s"),!1;if(e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="move",l.is(this)){var f=b.outerHeight(),g=a(this).outerHeight();if(d.forcePlaceholderSize&&m.height(f),g>f){var h=g-f,i=a(this).offset().top;if(m.index()<a(this).index()&&e.originalEvent.pageY<i+h)return!1;if(m.index()>a(this).index()&&e.originalEvent.pageY>i+g-h)return!1}b.hide(),a(this)[m.index()<a(this).index()?"after":"before"](m),c.not(m).detach()}else c.is(this)||a(this).children(d.items).length||(c.detach(),a(this).append(m));return!1})})}}($),jQuery(document).ready(function(){jQuery("#show-full-list-button").click(function(){jQuery("#future-read-list").hasClass("collapsed")?(jQuery("#future-read-list").addClass("expanded").removeClass("collapsed"),jQuery(this).text("Less Books"),visibleLooper()):(jQuery("#future-read-list").addClass("collapsed").removeClass("expanded"),jQuery(this).text("More Books"),jQuery("#future-read-list .overflow").each(function(){jQuery(this).removeClass("animate")}))}),jQuery("#finished-read-list, #current-read-list, #future-read-list").sortable({connectWith:".connected",forcePlaceholderSize:!0,items:":not(.disabled)"}).bind("sortupdate",function(a,b){var c=b.item[0].id;switch(jQuery(this).attr("id")){case"future-read-list":updateFutureList();break;case"current-read-list":updateCurrentList(c);break;case"finished-read-list":updateFinishedList(c)}});var a=!1;jQuery("#current-read-list .book").mousedown(function(){jQuery(window).mousemove(function(){a=!0,jQuery(window).unbind("mousemove"),jQuery("#finished-read").slideDown("slow",function(){})})}).mouseup(function(){a=!1,jQuery(window).unbind("mousemove")}),jQuery("#logged-out-warning a").click(function(){jQuery("#logged-out-warning").addClass("animate-close").removeClass("animate-open")});var b=jQuery("#future-read h1").offset().top,c=jQuery("#future-read h1").parent().width()+1+"px",d=jQuery("#future-read h1").outerHeight()+"px";jQuery(window).resize(function(){c=jQuery("#future-read").width()+1+"px",b=jQuery("#future-read h1").offset().top,jQuery("#future-read h1").css("width",c)}),jQuery(window).scrollTop()>=b?(jQuery("#future-read").addClass("sticky"),jQuery("#future-read h1").css("width",c),jQuery("#future-read-list").css("margin-top",d)):(jQuery("#future-read").removeClass("sticky"),jQuery("#future-read h1").css("width",c),jQuery("#future-read-list").css("margin-top","0")),jQuery(window).scroll(function(){jQuery(window).scrollTop()>=b?(jQuery("#future-read").addClass("sticky"),jQuery("#future-read h1").css("width",c),jQuery("#future-read-list").css("margin-top",d)):(jQuery("#future-read").removeClass("sticky"),jQuery("#future-read h1").css("width",c),jQuery("#future-read-list").css("margin-top","0"))}),jQuery(window).scroll(function(){visibleLooper()})});