var $=jQuery.noConflict(),ajaxURL=templateDirectory+"/php/save-list.php",futureReadList=$("#future-read-list"),showHideClicks=0,bookFunctions={toggleOptions:function(a){$("#"+a).hasClass("show-options")?($("#"+a).find(".book--options").slideUp(),$("#"+a).removeClass("show-options")):($("#"+a).find(".book--options").slideDown(),$("#"+a).addClass("show-options"))},updateList:function(a,b){var c=[],d=1;if("future"==a){$("#future-read-list .book").each(function(){c.push(this.id.substring(5)+":"+d),d++});var e={list:"future",future_list:c.join(",")}}else var e={list:a,id:b};$.ajax({type:"POST",url:ajaxURL,data:e,success:function(a){a.length&&$(".js-login-message").is(":hidden")&&$(".js-login-message").toggle()}})}},toggleLightbox=function(){$(".lightbox").toggle()},bookOptions=function(){$(".book").each(function(){var a=$(this).closest(".book-list");$(this).find(".book--options a").each(function(){a.hasClass($(this).attr("class"))&&$(this).addClass("active")})})},checkVisible=function(a,b){b=b||"visible";var c=$(window).height(),d=$(window).scrollTop(),e=$(a).offset().top,f=$(a).height();return"visible"===b?c+d>e&&e>d-f:"above"===b?c+d>e:void 0},visibleLooper=function(){$("#future-read-list").hasClass("expanded")&&$("#future-read-list").find(".overflow").each(function(){!$(this).hasClass("animate")&&checkVisible($(this),"above")&&$(this).delay(Math.floor(700*Math.random())).queue(function(){$(this).addClass("animate").dequeue()})})};$(document).ready(function(){bookOptions(),$(".js-lightbox-toggle").on("click",function(){toggleLightbox(),$(this).hasClass("site-action")&&$(".js-lightbox-content").empty().append($(this).parent().find("form").clone())}),$(".js-lightbox-content").on("click",".button",function(){if($(this).hasClass("add-book-form--button")){var a=$(this).closest("form"),b=a.find("#add-book-form--title").val(),c=a.find("#add-book-form--author").val();$.ajax({type:"POST",url:ajaxURL,data:{list:"new",title:b,author:c},success:function(d){if(a.find("input").val(""),toggleLightbox(),!isNaN(d)){var e=futureReadList.find("li").first().clone();e.css("opacity",".5").attr("id","book-"+d).attr("data-order","0").addClass("new-book").find(".book--series, .book--tags, .book--want-date, .book--links, .book--meta").remove().end().find(".book--title").text(b).end().find(".book--author span").text(c).end(),futureReadList.prepend(e),bookFunctions.updateList("future",e.attr("ID").substring(5)),e.delay(250).slideDown(400,function(){$(this).css("opacity","1")})}d.length}})}}),$(".book-list").on("click","h1",function(){bookFunctions.toggleOptions($(this).closest(".book").attr("ID"))}).on("click",".book--options a",function(){var a=$(this).closest(".book"),b=$(this).attr("class");$(this).hasClass("active")||$(this).hasClass("delete")||($(this).closest(".book--options").children("a").removeClass("active"),$(this).hasClass("finished")&&!$(this).hasClass("active")&&$("#finished-read").slideDown(),$(this).addClass("active"),a.css("opacity",".5").slideUp(400,function(){$(".book-list."+b).prepend(a),bookFunctions.updateList(b,a.attr("ID").substring(5)),bookFunctions.toggleOptions(a.attr("ID")),$("#"+a.attr("ID")).delay(250).slideDown(400,function(){$(this).css("opacity","1")})}))}).on("click",".book--link",function(){var a=$(this).closest(".book");$(this).hasClass("delete-link")&&confirm("Are you sure you want to delete "+a.find("h1").text()+"?")&&(bookFunctions.updateList("delete",a.attr("ID").substring(5)),a.css("opacity",".5").slideUp(400))}),$("#show-full-list-button").on("click",function(){futureReadList.toggleClass("expanded").toggleClass("collapsed"),futureReadList.hasClass("expanded")?$(this).text("less books"):$(this).text("more books");var a=showHideClicks%2==0?"open":"close";$.ajax({type:"POST",url:ajaxURL,data:{list:"bookList",status:a},beforeSend:function(){showHideClicks%2==0&&$(".loader-inner").toggle()},success:function(b){"open"==a?$("#future-read-list").append(b):$("#future-read-list").html(b)},complete:function(){showHideClicks%2==0&&$(".loader-inner").toggle(),showHideClicks++,bookOptions(),visibleLooper()}})}),$(".js-login-message").on("click","svg",function(){$(this).closest(".js-login-message").toggle()}),$(window).scroll(function(){visibleLooper()})});